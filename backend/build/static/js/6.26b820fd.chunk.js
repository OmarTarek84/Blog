(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{121:function(e,t,n){"use strict";var a=n(0),o=n.n(a);n(126);t.a=function(e){return o.a.createElement("div",{className:"profileModal"},e.children)}},122:function(e,t,n){"use strict";var a=n(0),o=n.n(a);n(127);t.a=function(e){return e.show?o.a.createElement("div",{className:"backdrop",onClick:e.clicked},e.children):null}},123:function(e,t,n){"use strict";var a=n(0),o=n.n(a);n(125);t.a=function(e){var t,n=null,a=[];switch(e.touched&&e.invalid&&(a.push("invalid"),t=e.errorMessage),!e.touched||e.invalid||e.invalidN||(a.push("valid"),t=""),e.touched&&e.invalidN&&(a.push("invalid-newpost"),t=e.errorMessage),!e.touched||e.invalidN||e.invalid||(a.push("valid-newpost"),t=""),e.elementType){case"input":n=o.a.createElement(o.a.Fragment,null,o.a.createElement("input",Object.assign({value:e.value},e.elementConfig,{onChange:e.changed,className:a.join(" ")})));break;case"textarea":n=o.a.createElement(o.a.Fragment,null,o.a.createElement("textarea",Object.assign({},e.elementConfig,{onChange:e.changed,className:a.join(" "),value:e.value})));break;case"select":n=o.a.createElement("select",{value:e.value,onChange:e.changed},e.elementConfig.options.map(function(e){return o.a.createElement("option",{value:e.value},e.displayValue)}));break;default:n=o.a.createElement("input",Object.assign({value:e.value},e.elementConfig,{onChange:e.changed}))}return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",null,e.label),n,o.a.createElement("p",{style:{color:"red"}},t))}},124:function(e,t,n){"use strict";var a=n(8),o=n(9),s=n(11),r=n(10),i=n(12),l=n(0),c=n.n(l),u=n(121),m=n(122);n(128);t.a=function(e,t){return function(n){function l(){var e,t;Object(a.a)(this,l);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(t=Object(s.a)(this,(e=Object(r.a)(l)).call.apply(e,[this].concat(o)))).state={error:null},t.closeBackdrop=function(){t.setState({error:null})},t}return Object(i.a)(l,n),Object(o.a)(l,[{key:"componentWillMount",value:function(){var e=this;this.reqInterceptor=t.interceptors.request.use(function(t){return e.setState({error:null}),t}),this.resInterceptor=t.interceptors.response.use(function(e){return e},function(t){e.setState({error:t})})}},{key:"componentWillUnmount",value:function(){t.interceptors.request.eject(this.reqInterceptor),t.interceptors.response.eject(this.resInterceptor)}},{key:"render",value:function(){var t;return t=this.state.error?this.state.error.response.data.errors[0].message:null,c.a.createElement(c.a.Fragment,null,c.a.createElement(m.a,{show:this.state.error,clicked:this.closeBackdrop},c.a.createElement(u.a,null,c.a.createElement("div",{className:"error"},c.a.createElement("h1",null,"An Error Occurred"),c.a.createElement("div",{className:"editProfile__icon",onClick:this.closeBackdrop},c.a.createElement("i",{className:"fas fa-times-circle"})),c.a.createElement("p",null,t)))),c.a.createElement(e,this.props))}}]),l}(l.Component)}},125:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){},128:function(e,t,n){},152:function(e,t){},172:function(e,t,n){},173:function(e,t,n){},174:function(e,t,n){},211:function(e,t,n){"use strict";n.r(t);var a=n(23),o=n(8),s=n(9),r=n(11),i=n(10),l=n(12),c=n(0),u=n.n(c),m=n(27),d=n(13),p=n.n(d),h=(n(172),n(122)),f=n(121),k=n(39),v=n(123),b=n(28),g=n(14),y=(n(173),n(15)),E=function(e){var t=["fas","fa-thumbs-up"];return e.buttonClicked&&t.push("clicked"),u.a.createElement("div",{className:"post"},u.a.createElement("h1",null,e.title),u.a.createElement("div",{className:"post__image"},u.a.createElement("img",{src:e.image,alt:"postImage"})),u.a.createElement("div",{className:"post__like"},u.a.createElement("div",{className:"post__like__font"},e.token&&e.userId!==e.postUserId?u.a.createElement(u.a.Fragment,null,u.a.createElement("input",{type:"checkbox",className:"likeInput",onChange:e.like,disabled:e.buttonClicked}),u.a.createElement("i",{className:t.join(" ")})):null,u.a.createElement("p",null,u.a.createElement("span",null,e.numberOfLikes)," Likes"))),u.a.createElement("div",{className:"post__body"},u.a.createElement("p",null,e.body)),u.a.createElement("div",{className:"post__postedBy"},u.a.createElement("p",null,"Posted By ",u.a.createElement("span",{onClick:e.onGoToProfile.bind(void 0,e.userPostId),style:{cursor:"pointer",textDecoration:"underline"}},e.postCreator)," On ",u.a.createElement("span",null,e.date))),u.a.createElement("div",{className:"post__buttons"},u.a.createElement("div",{className:"post__buttons__link"},u.a.createElement(y.b,{to:"/posts"},"Back To Posts")),e.userId===e.postUserId?u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"post__buttons__link"},u.a.createElement(m.a,{type:"button",click:e.openBackdrop,disabled:e.disabled},"Update Post")),u.a.createElement("div",{className:"post__buttons__link"},u.a.createElement(m.a,{type:"button",red:!0,click:e.deletePost,disabled:e.disabledd},"Delete Post"))):null))},S=n(124),_=(n(174),function(e){return u.a.createElement("div",{className:"post__comments__comments__comment"},u.a.createElement("p",null,e.comment),u.a.createElement("p",null,"Posted By ",u.a.createElement("span",null,e.user)," on ",u.a.createElement("span",null,e.date)))}),I=function(e){return u.a.createElement("div",{className:"post__comments__comments"},u.a.createElement("h3",null,u.a.createElement("span",null,e.numberOfComments)," Comments"),e.comments.map(function(e){return u.a.createElement(_,{key:e._id,comment:e.comment,user:e.user.name,date:e.createdAt})}))},C=n(143),P=n.n(C),j=n(38),O=n(142),B=n(141),w=j.a("allPosts",1,function(e){e.objectStoreNames.contains("posts")||e.createObjectStore("posts",{keyPath:"_id"}),e.objectStoreNames.contains("users")||e.createObjectStore("users",{keyPath:"_id"}),e.objectStoreNames.contains("sync-posts")||e.createObjectStore("sync-posts",{keyPath:"body"})});var N=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).signal=p.a.CancelToken.source(),n.state={commentEntered:"",backdropShow:!1,modalShow:!0,showSnackbar:!1,editPostForm:{title:{elementType:"input",elementConfig:{placeholder:"title of your post",type:"text",name:"title"},validationRules:{required:!0,maxLength:!0},valid:!1,touched:!1,value:"",label:"Title",errorMessage:"Characters should be between 1 and 30"},body:{elementType:"textarea",elementConfig:{placeholder:"Body of your post",type:"text",name:"body"},validationRules:{required:!0},valid:!1,touched:!1,value:"",label:"Body",errorMessage:"This Field Is Required"},postPhoto:{elementType:"input",elementConfig:{type:"file",name:"image"},validationRules:{},valid:!0,touched:!1,value:"",label:"Image Of Your Post",errorMessage:"This Field Is Required"}},formIsValid:!1,post:null,imageSelected:null,file:null,deleteButtonClicked:!1,buttonSelected:!1,commentButtonDisabled:!0,comments:[],numberOfComments:0,likes:0,buttonClicked:!1,editPostButtonClicked:!1},n.changeCommentInput=function(){""===n.inputRef.current.value?n.setState({commentButtonDisabled:!0}):n.setState({commentButtonDisabled:!1})},n.openBackdrop=function(){n.setState({backdropShow:!0});var e=Object(a.a)({},n.state.editPostForm),t=Object(a.a)({},e.title);t.value=n.state.post.title,t.valid=!0,e.title=t;var o=Object(a.a)({},e.body);o.value=n.state.post.body,o.valid=!0,e.body=o,n.setState({editPostForm:e,imageSelected:n.state.post.photo,formIsValid:!0})},n.closeBackdrop=function(){n.setState({backdropShow:!1})},n.changeInput=function(e,t){var o=Object(a.a)({},n.state.editPostForm),s=o[t];if(s.value=e.target.value,"postPhoto"===t){var r=e.target.files[0];n.setState({file:r,imageSelected:URL.createObjectURL(r)})}s.touched=!0,s.valid=n.checkValidity(s.validationRules,s.value),o[t]=s;var i=!0;for(var l in o)i=o[l].valid&&i;n.setState({editPostForm:o,formIsValid:i})},n.checkValidity=function(e,t){var n=!0;if(e.required&&(n=""!==t.trim()&&n),e.emailValid){n=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)&&n}return e.maxLength&&(n=t.length<=30&&n),n},n.editPost=function(e){e.preventDefault(),n.setState(function(e){return{editPostForm:Object(a.a)({},e.editPostForm,{postPhoto:Object(a.a)({},e.editPostForm.postPhoto,{value:""})})}}),n.setState({buttonSelected:!0,backdropShow:!1,editPostButtonClicked:!0});var t=new FormData;return t.append("image",n.state.file),p.a.put("/insertupdatePostImage",t,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.props.token},cancelToken:n.signal.token}).then(function(e){var t,o=e.data.filePath;t="notFound"===o?n.state.post.photo:o;var s={query:"\n                    mutation UpdatePost($id: String!, $title: String!, $body: String!, $photo: String!) {\n                        updatePost(updatePostInput: {id: $id, title: $title, body: $body, photo: $photo}) {\n                            _id\n                            title\n                            body\n                            photo\n                            user {\n                            _id\n                            name\n                            }\n                        }\n                    }  \n                ",variables:{id:n.state.post._id,title:n.state.editPostForm.title.value,body:n.state.editPostForm.body.value,photo:t}};return p.a.post("/graphql",s,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.props.token},cancelToken:n.signal.token}).then(function(e){var o=e.data.data.updatePost,s=Object(a.a)({},n.state.post);s.title=o.title,s.body=o.body,s.photo=t,n.setState({post:s,buttonSelected:!1,editPostButtonClicked:!1})})}).catch(function(e){console.log(e)})},n.deletePost=function(){var e,t;e="posts",t=n.state.post._id,w.then(function(n){var a=n.transaction(e,"readwrite");return a.objectStore(e).delete(t),a.complete}),n.setState({deleteButtonClicked:!0});var a={query:"\n                mutation DeletePost($postId: String!) {\n                    deletePost(postId: $postId) {\n                        _id\n                        posts {\n                          title\n                          body\n                          photo\n                        }\n                      }\n                }\n            ",variables:{postId:n.state.post._id}};return p.a.post("/graphql",a,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.props.token},cancelToken:n.signal.token}).then(function(e){n.setState({deleteButtonClicked:!1}),n.props.history.push("/posts")})},n.sendCommentInsertedToDB=function(e){e.preventDefault(),n.setState({commentButtonDisabled:!0,showSnackbar:!0});var t={query:"\n                mutation InsertComment($postId: String!, $comment: String!) {\n                    insertComment(postId: $postId, comment: $comment) {\n                        _id\n                        comment\n                        createdAt\n                        user {\n                          name\n                        }\n                      }\n                }\n            ",variables:{postId:n.state.post._id,comment:n.inputRef.current.value}};return p.a.post("/graphql",t,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.props.token},cancelToken:n.signal.token}).then(function(e){var t=e.data.data.insertComment;navigator.serviceWorker.ready.then(function(e){e.active.postMessage(JSON.stringify({postId:n.state.post._id,comment:t.comment,userInsertedComment:t.user.name}))}),n.inputRef.current.value="",n.setState(function(e){return{commentButtonDisabled:!1,showSnackbar:!1}})})},n.insertComment=function(e){navigator.onLine?n.sendCommentInsertedToDB(e):(e.preventDefault(),n.setState({commentButtonDisabled:!0,showSnackbar:!0}),"serviceWorker"in navigator&&"SyncManager"in window?navigator.serviceWorker.ready.then(function(e){var t,a,o={_id:(new B.a).toHexString(),postId:n.state.post._id,comment:n.inputRef.current.value,userId:n.props.userId,token:n.props.token};(t="sync-comments",a=o,w.then(function(e){var n=e.transaction(t,"readwrite");return n.objectStore(t).put(a),n.complete})).then(function(){return e.sync.register("sync-new-comments")}).then(function(){n.setState({showSnackbar:!1})}).then(function(){n.setState({commentButtonDisabled:!1})}).catch(function(e){console.log(e)})}):n.sendCommentInsertedToDB(e))},n.goToProfile=function(e){n.props.history.push({pathname:"/userprofile/"+e})},n.like=function(e){var t,a=e.target.checked;return n.setState({buttonClicked:!0}),t=a?{query:"\n                    mutation LikePost($postId: String!) {\n                        likePost(postId: $postId) {\n                            _id\n                            likes {\n                                name\n                            }\n                        }\n                    }\n                ",variables:{postId:n.props.match.params.id}}:{query:"\n                    mutation UnlikePost($postId: String!) {\n                        unlikePost(postId: $postId) {\n                            _id\n                            likes {\n                                name\n                            }\n                        }\n                    }\n                ",variables:{postId:n.props.match.params.id}},p.a.post("/graphql",t,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.props.token},cancelToken:n.signal.token}).then(function(e){e.data.data.likePost,n.setState(function(e){return{buttonClicked:!1}})})},n.inputRef=u.a.createRef(),n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=P()("/");t.on("newcomment",function(t){e.setState(function(e){return{comments:e.comments.concat(t.comment)}})}),t.on("likePost",function(t){var n=Object(a.a)({},e.state.post);n.likes.push(t.like),e.setState(function(e){return{likes:e.likes+1,post:n}})}),t.on("unLikePost",function(t){var n=e.state.post.likes.filter(function(t){return t._id!==e.props.userId});e.setState(function(e){return{likes:e.likes-1,post:Object(a.a)({},e.post,{likes:n})}})});var n={query:"\n                query SinglePost($postId: String!) {\n                    singlePost(postId: $postId) {\n                        _id\n                        title\n                        body\n                        photo\n                        createdAt\n                        user {\n                            _id\n                            name\n                            email\n                            photo\n                        }\n                        likes {\n                            _id\n                            name\n                        }\n                    }\n                }\n            ",variables:{postId:this.props.match.params.id}};p.a.post("/graphql",n,{headers:{"Content-Type":"application/json"},cancelToken:this.signal.token}).then(function(t){if(t){var n=t.data.data.singlePost;e.setState({post:n,likes:n.likes.length});var a=document.querySelector(".likeInput");n.likes.forEach(function(t){t._id===e.props.userId&&a&&(a.checked=!0)})}});var o={query:"\n                    query Comments($postId: String!) {\n                        comments(postId: $postId) {\n                            _id\n                            comment\n                            createdAt\n                            user {\n                              name\n                            }\n                          }\n                    }\n                ",variables:{postId:this.props.match.params.id}};return p.a.post("/graphql",o,{headers:{"Content-Type":"application/json"},cancelToken:this.signal.token}).then(function(t){e.setState({comments:t.data.data.comments})})}},{key:"componentWillUnmount",value:function(){this.signal.cancel("cancelled")}},{key:"render",value:function(){var e=this,t=[];for(var n in this.state.editPostForm)t.push({id:n,config:this.state.editPostForm[n]});var a=this.state,o=a.post,s=a.comments;return null===o||null===s?u.a.createElement(b.a,null):u.a.createElement(u.a.Fragment,null,u.a.createElement(O.a,{Icon:u.a.createElement("i",{className:"fas fa-alarm-clock"}),Show:this.state.showSnackbar},"Creating Your Comment..."),u.a.createElement(E,{openBackdrop:this.openBackdrop,title:this.state.post.title,body:this.state.post.body,image:this.state.post.photo,date:this.state.post.createdAt,postCreator:this.state.post.user.name,onGoToProfile:this.goToProfile,deletePost:this.deletePost,disabledd:this.state.deleteButtonClicked,userId:this.props.userId,postUserId:this.state.post.user._id,like:this.like,numberOfLikes:this.state.likes,buttonClicked:this.state.buttonClicked,token:this.props.token,userPostId:this.state.post.user._id,disabled:this.state.editPostButtonClicked}),this.props.token&&this.state.post.user._id!==this.props.userId?u.a.createElement("div",{className:"post__comments"},u.a.createElement("h2",null,"Leave A Comment"),u.a.createElement("form",{className:"post__comments__form"},u.a.createElement("input",{ref:this.inputRef,name:"comment",onChange:this.changeCommentInput,placeholder:"Leave A comment Here"}),u.a.createElement(m.a,{type:"submit",disabled:this.state.commentButtonDisabled,click:function(t){return e.insertComment(t)}},"POST"))):null,u.a.createElement(I,{comments:this.state.comments,numberOfComments:this.state.comments.length}),u.a.createElement(h.a,{show:this.state.backdropShow}),u.a.createElement(k.a,{mountOnEnter:!0,unmountOnExit:!0,in:this.state.backdropShow,timeout:{enter:1e3,exit:1e3},classNames:{enter:"",enterActive:"ModalOpen",exit:"",exitActive:"ModalClose"}},u.a.createElement(f.a,{viewModal:this.state.backdropShow},u.a.createElement("form",{className:"editPost__form",encType:"multipart/form-data"},u.a.createElement("h1",null,"Edit Your Post"),u.a.createElement("div",{className:"editPost__icon",onClick:this.closeBackdrop},u.a.createElement("i",{className:"fas fa-times-circle"})),t.map(function(t){return u.a.createElement("div",{key:t.id},u.a.createElement(v.a,{elementType:t.config.elementType,elementConfig:t.config.elementConfig,value:t.config.value,invalidN:!t.config.valid,touched:t.config.touched,label:t.config.label,key:t.id,changed:function(n){return e.changeInput(n,t.id)},errorMessage:t.config.errorMessage}))}),u.a.createElement(m.a,{type:"submit",disabled:!this.state.formIsValid||this.state.buttonSelected,click:this.editPost},"Update Post"),this.state.imageSelected?u.a.createElement("img",{src:this.state.imageSelected,name:"image",alt:"postImage",className:"imageSelected"}):null))))}}]),t}(c.Component);t.default=Object(S.a)(Object(g.b)(function(e){return{token:e.auth.token,userId:e.auth.userId}})(N),p.a)}}]);
//# sourceMappingURL=6.26b820fd.chunk.js.map