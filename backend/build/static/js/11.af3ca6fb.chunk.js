(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{152:function(t,e){},200:function(t,e,n){},201:function(t,e,n){},213:function(t,e,n){"use strict";n.r(e);var a=n(8),o=n(9),s=n(11),i=n(10),r=n(12),c=n(0),l=n.n(c),u=(n(200),n(201),n(27)),p=n(28),d=function(t){var e=t.activePage*t.itemPerPage,n=e-t.itemPerPage,a=t.posts.slice(n,e);return t.isLoading?l.a.createElement(p.a,null):a.map(function(e){return l.a.createElement("div",{className:"post",key:e._id},l.a.createElement("div",{className:"post__title"},e.title),l.a.createElement("div",{className:"post__desc"},e.body.substring(0,300)+"..."),l.a.createElement("div",{className:"post__button__link"},l.a.createElement(u.a,{click:t.onGoToSinglePost.bind(void 0,e._id)},"Read More")))})},g=n(202),h=n.n(g),m=n(13),P=n.n(m),f=n(143),v=n.n(f),b=n(38),k=n(14);n(205);var y=b.a("allPosts",1,function(t){t.objectStoreNames.contains("posts")||t.createObjectStore("posts",{keyPath:"_id"}),t.objectStoreNames.contains("users")||t.createObjectStore("posts",{keyPath:"_id"}),t.objectStoreNames.contains("sync-posts")||t.createObjectStore("sync-posts",{keyPath:"body"})});var S=function(t){function e(){var t,n;Object(a.a)(this,e);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(n=Object(s.a)(this,(t=Object(i.a)(e)).call.apply(t,[this].concat(r)))).deferredPrompt=null,n.networkDataReceived=!1,n.signal=P.a.CancelToken.source(),n.state={posts:[],itemPerPage:12,activePage:1,noPosts:!1,loading:!1},n.handlePageChange=function(t){n.setState({activePage:t})},n.onGoToSinglePost=function(t){n.props.history.push({pathname:"/post/"+t})},n.configurePushSub=function(){var t;!1 in navigator||navigator.serviceWorker.ready.then(function(e){return t=e,e.pushManager.getSubscription()}).then(function(e){if(e)return console.log(e.endpoint),null;var n=function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),a=new Uint8Array(n.length),o=0;o<n.length;++o)a[o]=n.charCodeAt(o);return a}("BLge1u7VbGLVM2pX5awJQlMCWCYk85dIszcMHqwA9MIksA8BPrJrA8x6ZB0OM9QOqbgL-NyqaR9pvKVJYSSgFZM");return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}).then(function(t){return t})}).then(function(t){if(t)return P.a.post("/subscribe",JSON.stringify(t),{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+n.props.token},cancelToken:n.signal.token}).then(function(t){console.log(t)}).catch(function(t){console.log(t)})})},n}return Object(r.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.props.token&&"Notification"in window&&Notification.requestPermission(function(e){"granted"!==e?console.log("not granted"):t.configurePushSub()});var e=v()("/");e.on("newpost",function(e){t.setState(function(t){return{posts:t.posts.concat(e.newPost)}})}),e.on("deletedPost",function(e){var n=t.state.posts.filter(function(t){return t._id!==e.deletedPost._id});t.setState({posts:n})}),this.setState({loading:!0});return P.a.post("/graphql",{query:"\n                query {\n                    posts {\n                        _id\n                        title\n                        body\n                        photo\n                        createdAt\n                        updatedAt\n                        comments {\n                            _id\n                            comment\n                            createdAt\n                        }\n                        user {\n                            _id\n                            name\n                            email\n                            createdAt\n                            photo\n                        }\n                    }\n                }\n            "},{headers:{"Content-Type":"application/json"},cancelToken:this.signal.token}).then(function(e){var n=e.data.data.posts;t.networkDataReceived=!0,n.length<=0?t.setState({noPosts:!0}):t.setState({noPosts:!1}),t.setState({posts:n})}).then(function(){t.setState({loading:!1})})}},{key:"componentWillUnmount",value:function(){this.signal.cancel("posts signal cancelled")}},{key:"render",value:function(){var t,e=this;return null===this.state.posts?l.a.createElement(p.a,null):("indexedDB"in window&&(navigator.onLine||(t="posts",y.then(function(e){return e.transaction(t,"readonly").objectStore(t).getAll()})).then(function(t){e.setState({posts:t})})),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"posts"},l.a.createElement("h1",null,"Posts"),l.a.createElement("div",{className:"post_flex"},this.state.noPosts?l.a.createElement("h2",null,"No Posts Created Yet"):l.a.createElement(d,{posts:this.state.posts,activePage:this.state.activePage,itemPerPage:this.state.itemPerPage,isLoading:this.state.loading,onGoToSinglePost:this.onGoToSinglePost}))),this.state.noPosts?null:l.a.createElement(h.a,{activePage:this.state.activePage,itemsCountPerPage:this.state.itemPerPage,totalItemsCount:this.state.posts.length,linkClass:"page-link",itemClass:"page-item",activeClass:"active",pageRangeDisplayed:5,onChange:this.handlePageChange.bind(this)})))}}]),e}(c.Component);e.default=Object(k.b)(function(t){return{token:t.auth.token}})(S)}}]);
//# sourceMappingURL=11.af3ca6fb.chunk.js.map